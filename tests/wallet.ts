import { expect } from 'chai';
import 'mocha';
import { MAX_SUPPLY_AMOUNT } from '../src/constant';
import { IsAddressValid, PubKeyHashFromAddress } from '../src/util';

import Wallet from '../src/wallet/wallet'

const data = `{"seed":{"seed":"fdeb4f090877932589bbb8837a8cf74acb63f63608af8de78bc404a51d02a961fdbaa9f0deb9f52c1e017fb61b97539fe4fc8ee84252c7d59ede1652eb7bcbb1"},"utxos":[{"tx_id":"8eee9fa467865363d775060172c75e8cd20136fd6510ea0f9b86714d8717245b","idx":43,"output":{"input_indexes":null,"value":178571428571,"pub_key_hash":"dc1c63f1c46ba70d3d94abdd572c5c54a641316b","k":0,"ta":[]},"mr":1,"cch":"1614285640478529","tx":null},{"tx_id":"b5ba49e903b05f8652d9f6e029413c9ceae05322b3bbccdb0444733b95e90955","idx":3,"output":{"input_indexes":null,"value":1433032616219,"pub_key_hash":"dc1c63f1c46ba70d3d94abdd572c5c54a641316b","k":0,"ta":[]},"mr":1,"cch":"1614285640466002","tx":null},{"tx_id":"5ed2a9e82f2b9309723681a04b8d6eea115d6dc9db6ef6bf9826b6365740da19","idx":1,"output":{"input_indexes":[0],"value":450000001,"pub_key_hash":"dc1c63f1c46ba70d3d94abdd572c5c54a641316b","k":0,"ta":[]},"mr":1,"cch":"1614285637366248","tx":null},{"tx_id":"355338ddca835fc6e8e89baa6fafc95e895a35b86a162f849d60705f608b468d","idx":1,"output":{"input_indexes":[0],"value":450000001,"pub_key_hash":"dc1c63f1c46ba70d3d94abdd572c5c54a641316b","k":0,"ta":[]},"mr":1,"cch":"1614285637366248","tx":null},{"tx_id":"eebe7a23915f2be5ad2a0d3891c9bd297e295603ee253859a0ebb36dc0414ea3","idx":1,"output":{"input_indexes":[0],"value":450000001,"pub_key_hash":"dc1c63f1c46ba70d3d94abdd572c5c54a641316b","k":0,"ta":[]},"mr":1,"cch":"1614285637366248","tx":null},{"tx_id":"066394ec8c5242b276794aa7b4d5dc459211a5684e5abc7ed159ce1bcdcaeb94","idx":1,"output":{"input_indexes":[0],"value":451237115,"pub_key_hash":"dc1c63f1c46ba70d3d94abdd572c5c54a641316b","k":0,"ta":[]},"mr":0.9972583961617546,"cch":"1614285637366248","tx":null},{"tx_id":"6c16a3df326a4d39ee8dcc1a3725aa2297c876f745d70b5549c10b4e40ff22f7","idx":1,"output":{"input_indexes":[0],"value":9849965706446,"pub_key_hash":"dc1c63f1c46ba70d3d94abdd572c5c54a641316b","k":0,"ta":[]},"mr":0.9993145990404386,"cch":"1614285637366248","tx":null}],"cch":{"list":["1614285640478529","1614285640466002","1614285637366248","1614285633699772","1614285629985444","1614285629822500","1614285629720545","1614285629672286","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],"last_height":8},"contract":{"value":"13LnUf4t","next_change":1613684544},"fees":{"fee_per_byte":1000000,"address":"12qAmof1p2U4KzkEXKz6vhFKFmFuAspJwk"},"costs":{"thread":50000000000,"proposal":500000000000,"upvote":1500000000,"reaction_0":6000000000,"reaction_1":25000000000,"reaction_2":100000000000,"P":null}}`
const wallet = new Wallet(JSON.parse(data), {})

describe('Testing wallets methods', () => {

    it('UTXOS: ', () => {
        const CCHList = wallet.cch().get().list()
        const utxos = wallet.utxos().get().get()

        expect(utxos.totalMeltedValue(CCHList)).to.equal(11442131552328)
        expect(utxos.totalValue()).to.equal(BigInt(11463370988354))
        const list = utxos.requiredList(Number(MAX_SUPPLY_AMOUNT), CCHList)
        expect(list.count()).to.equal(7)
        expect(utxos.listUnFetchedTxHash().length).to.eq(7)
    });


    it('Address: ', () => {
        const w = new Wallet({}, {})
        w.keys().set("solution benefit width ankle joy diamond kitchen account portion deer eye acid", "coucou")
        expect(w.keys().get().address()).to.eq("1G7EDQGMMuRaSsXysJTNTJd6N6i24Mm1cT")
        expect(Buffer.compare(PubKeyHashFromAddress(w.keys().get().address()), w.keys().get().pubHash())).to.eq(0)
        expect(IsAddressValid(w.keys().get().address())).to.eq(true)
    }) 

})